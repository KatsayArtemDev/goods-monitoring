import { Api, InputFile } from 'grammy';
import { selectAllUsers } from '../controllers/users.js';
import logger from '../logger.js';

export default async function newsletter(api: Api) {
    const allUsersIds = await selectAllUsers();
    if (!allUsersIds) {
        return;
    }

    const promo = new InputFile(
        './src/bot/configurations/templates/images/promo.mp4',
    );
    const caption = `
<b>–∫—É–ø–∏ –î–ï–®–ï–í–õ–ï ‚ö°Ô∏è –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å –∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ª—É—á—à–∏–º —Ä–µ—à–µ–Ω–∏–µ–º –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏!</b>

üî• <u>–ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ –Ω–µ —Ö–æ—á–µ—Ç –∂–¥–∞—Ç—å:</u>

<b>–ü–æ –æ–¥–Ω–æ–º—É –Ω–∞–∑–≤–∞–Ω–∏—é –±–æ—Ç –Ω–∞–π–¥—ë—Ç, –≥–¥–µ –∫—É–ø–∏—Ç—å —Ç–æ–≤–∞—Ä –¥–µ—à–µ–≤–ª–µ —É–∂–µ —Å–µ–π—á–∞—Å!</b>
<i>üìé –î–æ–±–∞–≤–∏—Ç—å > üîé –ù–∞–π—Ç–∏ –¥–µ—à–µ–≤–ª–µ</i>

üéÅ <u>–ü–æ—è–≤–∏–ª–∞—Å—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª—É—á–∞—Ç—å –µ—â—ë –±–æ–ª—å—à–µ –≤—ã–≥–æ–¥—ã:</u>

<b>–ü–æ–¥—Å—Ç—Ä–æ–∏–º –±–æ—Ç–∞ –ø–æ–¥ –í–∞—Å, —á—Ç–æ–±—ã –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±—ã–ª–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–∏–±—ã–ª—å–Ω—ã–º!</b>
<i>üëëÔ∏è –ü–æ–¥–ø–∏—Å–∫–∞ > üí∞ –ë–æ–ª—å—à–µ –≤—ã–≥–æ–¥—ã</i>

<b>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—è –ø—Ä–æ–µ–∫—Ç –º–æ–∂–Ω–æ —É—Å–∫–æ—Ä–∏—Ç—å –≤—ã—Ö–æ–¥ –Ω–æ–≤—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º!</b>
<i>‚öôÔ∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ > üí∏ –ü–æ–º–æ—á—å –ø—Ä–æ–µ–∫—Ç—É</i>

üíØ <b>–≠–∫–æ–Ω–æ–º—å—Ç–µ –Ω–∞ –ø–æ–∫—É–ø–∫–∞—Ö –Ω–µ —Ç—Ä–∞—Ç—è –≤—Ä–µ–º—è!</b>
`;

    for (const { user_id } of allUsersIds) {
        try {
            await api.sendVideo(user_id, promo, {
                caption,
                supports_streaming: true,
            });
        } catch (error) {
            logger.error(
                `Sending newsletter | userId: ${user_id}, error: ${error}`,
            );
        }
    }
}
